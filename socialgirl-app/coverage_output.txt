
> socialgirl-app@0.0.0 test:coverage
> vitest --coverage --run


 RUN  v3.2.4 /home/ken/Projects/Socialgirl/socialgirl-app
      Coverage enabled with v8

stderr | src/__tests__/services/searchService.test.js > SearchService > YouTube search > should return empty array when channel not found
YouTube channel not found for handle: @unknownchannel

stderr | src/__tests__/services/searchService.test.js > SearchService > TikTok search > should throw error when TikTok user not found
Error in TikTok user posts search: Error: User 'unknownuser' not found
    at TikTokSearchStrategy.searchUserPosts [90m(/home/ken/Projects/Socialgirl/socialgirl-app/[39msrc/services/searchService.js:110:23[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at TikTokSearchStrategy.search [90m(/home/ken/Projects/Socialgirl/socialgirl-app/[39msrc/services/searchService.js:90:20[90m)[39m
    at SearchService.search [90m(/home/ken/Projects/Socialgirl/socialgirl-app/[39msrc/services/searchService.js:26:16[90m)[39m

stderr | src/__tests__/services/searchService.test.js > SearchService > TikTok search > should throw user-friendly error for TikTok user not found
Error in TikTok user posts search: Error: User not found
    at [90m/home/ken/Projects/Socialgirl/socialgirl-app/[39msrc/__tests__/services/searchService.test.js:164:53
    at [90mfile:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at runSuite [90m(file:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

stdout | src/__tests__/services/searchService.test.js > SearchService > Instagram search > should search Instagram videos
[Instagram Search] Starting search with query: "test query"
[Instagram Search] Search context: { activeTab: [32m'videos'[39m }
[Instagram Search] Starting video search for keyword: "test query"
[Instagram Search] Calling searchReels API...

stdout | src/__tests__/services/searchService.test.js > SearchService > Instagram search > should search Instagram videos
[Instagram Search] API call successful, processing response...
[Instagram Search] Data extraction complete. Found 1 videos

stdout | src/__tests__/services/searchService.test.js > SearchService > Instagram search > should search Instagram user posts
[Instagram Search] Starting search with query: "@username"
[Instagram Search] Search context: { activeTab: [32m'userVideos'[39m }
[Instagram Search] Starting user posts search for username: "@username"
[Instagram Search] Cleaned username: "username"
[Instagram Search] Calling getUserReels API...

stdout | src/__tests__/services/searchService.test.js > SearchService > Instagram search > should search Instagram user posts
[Instagram Search] API call successful, processing response...
[Instagram Search] Data extraction complete. Found 1 posts
[Instagram Search] Sample extracted post: {
  username: [90mundefined[39m,
  title: [32m'Post 1...'[39m,
  likes: [90mundefined[39m,
  views: [90mundefined[39m
}

stdout | src/__tests__/services/searchService.test.js > SearchService > Instagram search > should handle Instagram API key error
[Instagram Search] Starting search with query: "test"
[Instagram Search] Search context: { activeTab: [32m'videos'[39m }
[Instagram Search] Starting video search for keyword: "test"
[Instagram Search] Calling searchReels API...

stderr | src/__tests__/services/searchService.test.js > SearchService > Instagram search > should handle Instagram API key error
[Instagram Search] Error in searchVideos: {
  keyword: [32m'test'[39m,
  errorMessage: [32m'API key missing'[39m,
  errorType: [32m'Error'[39m,
  stack: [32m'Error: API key missing\n'[39m +
    [32m'    at /home/ken/Projects/Socialgirl/socialgirl-app/src/__tests__/services/searchService.test.js:211:56\n'[39m +
    [32m'    at file:///home/ken/Projects/Socialgirl/socialgirl-app/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n'[39m +
    [32m'    at file:///home/ken/Projects/Socialgirl/socialgirl-app/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n'[39m +
    [32m'    at file:///home/ken/Projects/Socialgirl/socialgirl-app/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n'[39m +
    [32m'    at new Promise (<anonymous>)\n'[39m +
    [32m'    at runWithTimeout (file:///home/ken/Projects/Socialgirl/socialgirl-app/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n'[39m +
    [32m'    at runTest (file:///home/ken/Projects/Socialgirl/socialgirl-app/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n'[39m +
    [32m'    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n'[39m +
    [32m'    at runSuite (file:///home/ken/Projects/Socialgirl/socialgirl-app/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n'[39m +
    [32m'    at runSuite (file:///home/ken/Projects/Socialgirl/socialgirl-app/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)'[39m
}

stdout | src/__tests__/services/searchService.test.js > SearchService > Instagram search > should handle Instagram quota exceeded error
[Instagram Search] Starting search with query: "test"
[Instagram Search] Search context: { activeTab: [32m'videos'[39m }
[Instagram Search] Starting video search for keyword: "test"
[Instagram Search] Calling searchReels API...

stderr | src/__tests__/services/searchService.test.js > SearchService > Instagram search > should handle Instagram quota exceeded error
[Instagram Search] Error in searchVideos: {
  keyword: [32m'test'[39m,
  errorMessage: [32m'quota exceeded'[39m,
  errorType: [32m'Error'[39m,
  stack: [32m'Error: quota exceeded\n'[39m +
    [32m'    at /home/ken/Projects/Socialgirl/socialgirl-app/src/__tests__/services/searchService.test.js:218:56\n'[39m +
    [32m'    at file:///home/ken/Projects/Socialgirl/socialgirl-app/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n'[39m +
    [32m'    at file:///home/ken/Projects/Socialgirl/socialgirl-app/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n'[39m +
    [32m'    at file:///home/ken/Projects/Socialgirl/socialgirl-app/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n'[39m +
    [32m'    at new Promise (<anonymous>)\n'[39m +
    [32m'    at runWithTimeout (file:///home/ken/Projects/Socialgirl/socialgirl-app/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n'[39m +
    [32m'    at runTest (file:///home/ken/Projects/Socialgirl/socialgirl-app/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n'[39m +
    [32m'    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n'[39m +
    [32m'    at runSuite (file:///home/ken/Projects/Socialgirl/socialgirl-app/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n'[39m +
    [32m'    at runSuite (file:///home/ken/Projects/Socialgirl/socialgirl-app/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)'[39m
}

stdout | src/__tests__/services/searchService.test.js > SearchService > Instagram search > should handle Instagram user not found error
[Instagram Search] Starting search with query: "unknownuser"
[Instagram Search] Search context: { activeTab: [32m'userVideos'[39m }
[Instagram Search] Starting user posts search for username: "unknownuser"
[Instagram Search] Cleaned username: "unknownuser"
[Instagram Search] Calling getUserReels API...

stderr | src/__tests__/services/searchService.test.js > SearchService > Instagram search > should handle Instagram user not found error
[Instagram Search] Error in searchUserPosts: {
  username: [32m'unknownuser'[39m,
  errorMessage: [32m'404 not found'[39m,
  errorType: [32m'Error'[39m,
  stack: [32m'Error: 404 not found\n'[39m +
    [32m'    at /home/ken/Projects/Socialgirl/socialgirl-app/src/__tests__/services/searchService.test.js:225:57\n'[39m +
    [32m'    at file:///home/ken/Projects/Socialgirl/socialgirl-app/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11\n'[39m +
    [32m'    at file:///home/ken/Projects/Socialgirl/socialgirl-app/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26\n'[39m +
    [32m'    at file:///home/ken/Projects/Socialgirl/socialgirl-app/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20\n'[39m +
    [32m'    at new Promise (<anonymous>)\n'[39m +
    [32m'    at runWithTimeout (file:///home/ken/Projects/Socialgirl/socialgirl-app/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)\n'[39m +
    [32m'    at runTest (file:///home/ken/Projects/Socialgirl/socialgirl-app/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)\n'[39m +
    [32m'    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n'[39m +
    [32m'    at runSuite (file:///home/ken/Projects/Socialgirl/socialgirl-app/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)\n'[39m +
    [32m'    at runSuite (file:///home/ken/Projects/Socialgirl/socialgirl-app/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)'[39m
}

stdout | src/__tests__/services/searchService.test.js > SearchService > Instagram search > should return empty array for unimplemented Instagram tabs
[Instagram Search] Starting search with query: "test"
[Instagram Search] Search context: { activeTab: [32m'users'[39m }

stderr | src/__tests__/services/searchService.test.js > SearchService > Instagram search > should return empty array for unimplemented Instagram tabs
[Instagram Search] Tab "users" not yet implemented

 ❯ src/__tests__/contexts/ApiKeyContext.test.jsx (12 tests | 1 failed) 55ms
   × ApiKeyContext > useApiKeys hook > should throw error when used outside ApiKeyProvider 19ms
     → expected [Function] to throw an error
   ✓ ApiKeyContext > useApiKeys hook > should provide context functions when used within ApiKeyProvider 2ms
   ✓ ApiKeyContext > ApiKeyProvider > should render children 13ms
   ✓ ApiKeyContext > ApiKeyProvider > should initialize with empty state when no session storage 2ms
   ✓ ApiKeyContext > ApiKeyProvider > should initialize from session storage when available 1ms
   ✓ ApiKeyContext > ApiKeyProvider > should handle session storage load error gracefully 2ms
   ✓ ApiKeyContext > ApiKeyProvider > should set API keys and save to session storage 2ms
   ✓ ApiKeyContext > ApiKeyProvider > should handle session storage save error gracefully 2ms
   ✓ ApiKeyContext > ApiKeyProvider > should get API key with logging 3ms
   ✓ ApiKeyContext > ApiKeyProvider > should return null for non-existent key 1ms
   ✓ ApiKeyContext > ApiKeyProvider > should clear all API keys and session storage 2ms
   ✓ ApiKeyContext > ApiKeyProvider > should handle session storage clear error gracefully 2ms
 ✓ src/__tests__/services/searchService.test.js (17 tests) 44ms
 ✓ src/__tests__/utils/formatters.test.js (23 tests) 28ms
 ✓ src/__tests__/components/Pagination.test.jsx (15 tests) 150ms
 ❯ src/__tests__/components/SearchBar.test.jsx (11 tests | 2 failed) 242ms
   ✓ SearchBar > should render with default placeholder 25ms
   ✓ SearchBar > should render with custom placeholder 2ms
   × SearchBar > should render search icon 60ms
     → Unable to find an element with the role "img"

Here are the available roles:

  textbox:

  Name "":
  [36m<input[39m
    [33mplaceholder[39m=[32m"Search Users"[39m
    [33mtype[39m=[32m"text"[39m
    [33mvalue[39m=[32m""[39m
  [36m/>[39m

  --------------------------------------------------

Ignored nodes: comments, script, style
[36m<body>[39m
  [36m<div>[39m
    [36m<form>[39m
      [36m<div[39m
        [33mclass[39m=[32m"morph-search"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"morph-border"[39m
        [36m/>[39m
        [36m<svg[39m
          [33mclass[39m=[32m"search-icon"[39m
          [33mfill[39m=[32m"none"[39m
          [33mheight[39m=[32m"16"[39m
          [33mviewBox[39m=[32m"0 0 24 24"[39m
          [33mwidth[39m=[32m"16"[39m
          [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
        [36m>[39m
          [36m<path[39m
            [33md[39m=[32m"M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z"[39m
            [33mstroke[39m=[32m"currentColor"[39m
            [33mstroke-linecap[39m=[32m"round"[39m
            [33mstroke-linejoin[39m=[32m"round"[39m
            [33mstroke-width[39m=[32m"2"[39m
          [36m/>[39m
        [36m</svg>[39m
        [36m<input[39m
          [33mplaceholder[39m=[32m"Search Users"[39m
          [33mtype[39m=[32m"text"[39m
          [33mvalue[39m=[32m""[39m
        [36m/>[39m
      [36m</div>[39m
    [36m</form>[39m
  [36m</div>[39m
[36m</body>[39m
   ✓ SearchBar > should update input value when typing 56ms
   ✓ SearchBar > should call onSearch when form is submitted 10ms
   ✓ SearchBar > should call onSearch with empty string when submitted without input 4ms
   ✓ SearchBar > should prevent default form submission 5ms
   ✓ SearchBar > should have proper CSS classes for styling 6ms
   ✓ SearchBar > should handle rapid input changes 56ms
   × SearchBar > should maintain state between searches 11ms
     → [2mexpect([22m[31melement[39m[2m).toHaveValue()[22m

Expected the element to have value:
[32m[39m
Received:
[31m  first search[39m
   ✓ SearchBar > should handle special characters in search 5ms
 ✓ src/__tests__/utils/apiKeyManager.test.js (8 tests) 17ms
 ❯ src/__tests__/utils/encryption.test.js (8 tests | 2 failed) 40ms
   × encryption utilities > encryptData > should encrypt data successfully 29ms
     → expected "spy" to be called with arguments: [ 'raw', Any<Uint8Array>, …(3) ][90m

Received: 

[1m  1st spy call:

[22m[33m@@ -1,8 +1,22 @@[90m
[2m  [[22m
[2m    "raw",[22m
[32m-   Any<Uint8Array>,[90m
[31m+   Uint8Array [[90m
[31m+     116,[90m
[31m+     101,[90m
[31m+     115,[90m
[31m+     116,[90m
[31m+     45,[90m
[31m+     112,[90m
[31m+     97,[90m
[31m+     115,[90m
[31m+     115,[90m
[31m+     119,[90m
[31m+     111,[90m
[31m+     114,[90m
[31m+     100,[90m
[31m+   ],[90m
[2m    {[22m
[2m      "name": "PBKDF2",[22m
[2m    },[22m
[2m    false,[22m
[2m    [[22m
[39m[90m

Number of calls: [1m1[22m
[39m
   ✓ encryption utilities > encryptData > should handle encryption errors 3ms
   × encryption utilities > decryptData > should decrypt data successfully 2ms
     → expected "spy" to be called with arguments: [ 'raw', Any<Uint8Array>, …(3) ][90m

Received: 

[1m  1st spy call:

[22m[33m@@ -1,8 +1,22 @@[90m
[2m  [[22m
[2m    "raw",[22m
[32m-   Any<Uint8Array>,[90m
[31m+   Uint8Array [[90m
[31m+     116,[90m
[31m+     101,[90m
[31m+     115,[90m
[31m+     116,[90m
[31m+     45,[90m
[31m+     112,[90m
[31m+     97,[90m
[31m+     115,[90m
[31m+     115,[90m
[31m+     119,[90m
[31m+     111,[90m
[31m+     114,[90m
[31m+     100,[90m
[31m+   ],[90m
[2m    {[22m
[2m      "name": "PBKDF2",[22m
[2m    },[22m
[2m    false,[22m
[2m    [[22m
[39m[90m

Number of calls: [1m1[22m
[39m
   ✓ encryption utilities > decryptData > should handle decryption errors 1ms
   ✓ encryption utilities > localStorage helpers > should save encrypted settings to localStorage 1ms
   ✓ encryption utilities > localStorage helpers > should load encrypted settings from localStorage 1ms
   ✓ encryption utilities > localStorage helpers > should return null when no settings in localStorage 0ms
   ✓ encryption utilities > localStorage helpers > should clear stored settings from localStorage 0ms
 ✓ src/__tests__/contexts/ToastContext.test.jsx (9 tests) 72ms
 ❯ src/__tests__/apis/youtube.test.js (12 tests | 8 failed) 69ms
   ✓ YouTube API > searchVideos > should search videos successfully 9ms
   × YouTube API > searchVideos > should use custom options 29ms
     → expected 'https://www.googleapis.com/youtube/v3…' to contain 'publishedAfter=2024-01-01T00%3A00%3A0…'
   ✓ YouTube API > searchVideos > should throw error when quota exceeded 3ms
   ✓ YouTube API > searchVideos > should throw error when API key not found 0ms
   ✓ YouTube API > searchVideos > should throw error on API error response 0ms
   × YouTube API > getVideosStatistics > should get video statistics for multiple videos 5ms
     → expected "spy" to be called with arguments: [ StringContaining{…} ][90m

Received: 

[1m  1st spy call:

[22m[2m  [[22m
[32m-   StringContaining "id=video1%2Cvideo2",[90m
[31m+   "https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&id=video1,video2&key=test-api-key",[90m
[2m  ][22m
[39m[90m

Number of calls: [1m1[22m
[39m
   × YouTube API > getVideosStatistics > should handle empty video IDs array 2ms
     → expected { items: [] } to deeply equal []
   × YouTube API > getVideosStatistics > should batch large video ID arrays 1ms
     → expected "spy" to be called 2 times, but got 1 times
   × YouTube API > getChannelIdFromHandle > should get channel ID from handle 1ms
     → getChannelIdFromHandle is not a function
   × YouTube API > getChannelIdFromHandle > should throw error when channel not found 0ms
     → getChannelIdFromHandle is not a function
   × YouTube API > getChannelVideosByHandle > should get channel videos by handle 14ms
     → Channel not found for handle: @testchannel
   × YouTube API > getChannelVideosByHandle > should filter out videos without videoId 1ms
     → Channel not found for handle: @testchannel
stderr | src/__tests__/hooks/useSearch.test.js > useSearch > should handle search errors
youtube search error: Error: Search failed
    at [90m/home/ken/Projects/Socialgirl/socialgirl-app/[39msrc/__tests__/hooks/useSearch.test.js:148:23
    at [90mfile:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
    at runSuite [90m(file:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runFiles [90m(file:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1787:3[90m)[39m

stderr | src/__tests__/hooks/useSearch.test.js > useSearch > should show alert for user posts json error
instagram search error: Error: Failed to parse json response
    at [90m/home/ken/Projects/Socialgirl/socialgirl-app/[39msrc/__tests__/hooks/useSearch.test.js:164:23
    at [90mfile:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
    at runSuite [90m(file:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runFiles [90m(file:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1787:3[90m)[39m

stderr | src/__tests__/hooks/useSearch.test.js > useSearch > should show alert for user videos error
tiktok search error: Error: User not found
    at [90m/home/ken/Projects/Socialgirl/socialgirl-app/[39msrc/__tests__/hooks/useSearch.test.js:180:23
    at [90mfile:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
    at runSuite [90m(file:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runFiles [90m(file:///home/ken/Projects/Socialgirl/socialgirl-app/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1787:3[90m)[39m

 ✓ src/__tests__/hooks/useSearch.test.js (10 tests) 35ms
 ✓ src/__tests__/components/GenericResizableTable.test.jsx (10 tests) 196ms
 ✓ src/__tests__/contexts/DialogContext.test.jsx (12 tests) 261ms

⎯⎯⎯⎯⎯⎯ Failed Tests 13 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  src/__tests__/apis/youtube.test.js > YouTube API > searchVideos > should use custom options
AssertionError: expected 'https://www.googleapis.com/youtube/v3…' to contain 'publishedAfter=2024-01-01T00%3A00%3A0…'

Expected: [32m"publishedAfter=2024-01-01T00%3A00%3A00Z"[39m
Received: [31m"https://www.googleapis.com/youtube/v3/search?part=snippet&q=test&type=video&order=date&publishedAfter=2024-01-01T00:00:00Z&maxResults=20&key=test-api-key&regionCode=US"[39m

 ❯ src/__tests__/apis/youtube.test.js:73:25
     71|             const url = fetch.mock.calls[0][0];
     72|             expect(url).toContain('order=date');
     73|             expect(url).toContain('publishedAfter=2024-01-01T00%3A00%3…
       |                         ^
     74|             expect(url).toContain('regionCode=US');
     75|             expect(url).toContain('maxResults=20');

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/13]⎯

 FAIL  src/__tests__/apis/youtube.test.js > YouTube API > getVideosStatistics > should get video statistics for multiple videos
AssertionError: expected "spy" to be called with arguments: [ StringContaining{…} ][90m

Received: 

[1m  1st spy call:

[22m[2m  [[22m
[32m-   StringContaining "id=video1%2Cvideo2",[90m
[31m+   "https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&id=video1,video2&key=test-api-key",[90m
[2m  ][22m
[39m[90m

Number of calls: [1m1[22m
[39m
 ❯ src/__tests__/apis/youtube.test.js:125:27
    123|             const result = await getVideosStatistics(['video1', 'video…
    124| 
    125|             expect(fetch).toHaveBeenCalledWith(
       |                           ^
    126|                 expect.stringContaining('id=video1%2Cvideo2')
    127|             );

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/13]⎯

 FAIL  src/__tests__/apis/youtube.test.js > YouTube API > getVideosStatistics > should handle empty video IDs array
AssertionError: expected { items: [] } to deeply equal []

[32m- Expected:[39m 
[]

[31m+ Received:[39m 
{
  "items": [],
}

 ❯ src/__tests__/apis/youtube.test.js:133:28
    131|         it('should handle empty video IDs array', async () => {
    132|             const result = await getVideosStatistics([]);
    133|             expect(result).toEqual([]);
       |                            ^
    134|             expect(fetch).not.toHaveBeenCalled();
    135|         });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/13]⎯

 FAIL  src/__tests__/apis/youtube.test.js > YouTube API > getVideosStatistics > should batch large video ID arrays
AssertionError: expected "spy" to be called 2 times, but got 1 times
 ❯ src/__tests__/apis/youtube.test.js:152:27
    150|             const result = await getVideosStatistics(videoIds);
    151| 
    152|             expect(fetch).toHaveBeenCalledTimes(2);
       |                           ^
    153|             expect(result).toHaveLength(60);
    154|         });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/13]⎯

 FAIL  src/__tests__/apis/youtube.test.js > YouTube API > getChannelIdFromHandle > should get channel ID from handle
TypeError: getChannelIdFromHandle is not a function
 ❯ src/__tests__/apis/youtube.test.js:171:34
    169|             });
    170| 
    171|             const result = await getChannelIdFromHandle('@testchannel'…
       |                                  ^
    172| 
    173|             expect(fetch).toHaveBeenCalledWith(

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/13]⎯

 FAIL  src/__tests__/apis/youtube.test.js > YouTube API > getChannelIdFromHandle > should throw error when channel not found
TypeError: getChannelIdFromHandle is not a function
 ❯ src/__tests__/apis/youtube.test.js:185:26
    183|             });
    184| 
    185|             await expect(getChannelIdFromHandle('@unknown'))
       |                          ^
    186|                 .rejects.toThrow('Channel not found for handle: @unkno…
    187|         });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/13]⎯

 FAIL  src/__tests__/apis/youtube.test.js > YouTube API > getChannelVideosByHandle > should get channel videos by handle
Error: Channel not found for handle: @testchannel
 ❯ Module.getChannelVideosByHandle src/apis/youtube.js:236:15
    234|     const channelId = await getChannelByHandle(handle);
    235|     if (!channelId) {
    236|         throw new Error(`Channel not found for handle: ${handle}`);
       |               ^
    237|     }
    238|     
 ❯ src/__tests__/apis/youtube.test.js:222:28

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/13]⎯

 FAIL  src/__tests__/apis/youtube.test.js > YouTube API > getChannelVideosByHandle > should filter out videos without videoId
Error: Channel not found for handle: @testchannel
 ❯ Module.getChannelVideosByHandle src/apis/youtube.js:236:15
    234|     const channelId = await getChannelByHandle(handle);
    235|     if (!channelId) {
    236|         throw new Error(`Channel not found for handle: ${handle}`);
       |               ^
    237|     }
    238|     
 ❯ src/__tests__/apis/youtube.test.js:260:28

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[8/13]⎯

 FAIL  src/__tests__/components/SearchBar.test.jsx > SearchBar > should render search icon
TestingLibraryElementError: Unable to find an element with the role "img"

Here are the available roles:

  textbox:

  Name "":
  [36m<input[39m
    [33mplaceholder[39m=[32m"Search Users"[39m
    [33mtype[39m=[32m"text"[39m
    [33mvalue[39m=[32m""[39m
  [36m/>[39m

  --------------------------------------------------

Ignored nodes: comments, script, style
[36m<body>[39m
  [36m<div>[39m
    [36m<form>[39m
      [36m<div[39m
        [33mclass[39m=[32m"morph-search"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"morph-border"[39m
        [36m/>[39m
        [36m<svg[39m
          [33mclass[39m=[32m"search-icon"[39m
          [33mfill[39m=[32m"none"[39m
          [33mheight[39m=[32m"16"[39m
          [33mviewBox[39m=[32m"0 0 24 24"[39m
          [33mwidth[39m=[32m"16"[39m
          [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
        [36m>[39m
          [36m<path[39m
            [33md[39m=[32m"M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z"[39m
            [33mstroke[39m=[32m"currentColor"[39m
            [33mstroke-linecap[39m=[32m"round"[39m
            [33mstroke-linejoin[39m=[32m"round"[39m
            [33mstroke-width[39m=[32m"2"[39m
          [36m/>[39m
        [36m</svg>[39m
        [36m<input[39m
          [33mplaceholder[39m=[32m"Search Users"[39m
          [33mtype[39m=[32m"text"[39m
          [33mvalue[39m=[32m""[39m
        [36m/>[39m
      [36m</div>[39m
    [36m</form>[39m
  [36m</div>[39m
[36m</body>[39m
 ❯ Object.getElementError node_modules/@testing-library/dom/dist/config.js:37:19
 ❯ node_modules/@testing-library/dom/dist/query-helpers.js:76:38
 ❯ node_modules/@testing-library/dom/dist/query-helpers.js:52:17
 ❯ node_modules/@testing-library/dom/dist/query-helpers.js:95:19
 ❯ src/__tests__/components/SearchBar.test.jsx:24:28
     22|         render(<SearchBar onSearch={vi.fn()} />);
     23|         
     24|         const svg = screen.getByRole('img', { hidden: true });
       |                            ^
     25|         expect(svg).toBeInTheDocument();
     26|         expect(svg).toHaveClass('search-icon');

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[9/13]⎯

 FAIL  src/__tests__/components/SearchBar.test.jsx > SearchBar > should maintain state between searches
Error: [2mexpect([22m[31melement[39m[2m).toHaveValue()[22m

Expected the element to have value:
[32m[39m
Received:
[31m  first search[39m
 ❯ src/__tests__/components/SearchBar.test.jsx:117:26
    115|         // Input should be cleared after rerender (new component insta…
    116|         const newInput = screen.getByPlaceholderText('Search Users');
    117|         expect(newInput).toHaveValue('');
       |                          ^
    118|     });
    119| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[10/13]⎯

 FAIL  src/__tests__/contexts/ApiKeyContext.test.jsx > ApiKeyContext > useApiKeys hook > should throw error when used outside ApiKeyProvider
AssertionError: expected [Function] to throw an error

[32m- Expected:[39m 
null

[31m+ Received:[39m 
undefined

 ❯ src/__tests__/contexts/ApiKeyContext.test.jsx:47:16
     45|             expect(() => {
     46|                 renderHook(() => useApiKeys());
     47|             }).toThrow('useApiKeys must be used within an ApiKeyProvid…
       |                ^
     48| 
     49|             console.error = originalError;

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[11/13]⎯

 FAIL  src/__tests__/utils/encryption.test.js > encryption utilities > encryptData > should encrypt data successfully
AssertionError: expected "spy" to be called with arguments: [ 'raw', Any<Uint8Array>, …(3) ][90m

Received: 

[1m  1st spy call:

[22m[33m@@ -1,8 +1,22 @@[90m
[2m  [[22m
[2m    "raw",[22m
[32m-   Any<Uint8Array>,[90m
[31m+   Uint8Array [[90m
[31m+     116,[90m
[31m+     101,[90m
[31m+     115,[90m
[31m+     116,[90m
[31m+     45,[90m
[31m+     112,[90m
[31m+     97,[90m
[31m+     115,[90m
[31m+     115,[90m
[31m+     119,[90m
[31m+     111,[90m
[31m+     114,[90m
[31m+     100,[90m
[31m+   ],[90m
[2m    {[22m
[2m      "name": "PBKDF2",[22m
[2m    },[22m
[2m    false,[22m
[2m    [[22m
[39m[90m

Number of calls: [1m1[22m
[39m
 ❯ src/__tests__/utils/encryption.test.js:81:49
     79| 
     80|             // Verify crypto calls
     81|             expect(mockCrypto.subtle.importKey).toHaveBeenCalledWith(
       |                                                 ^
     82|                 'raw',
     83|                 expect.any(Uint8Array),

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[12/13]⎯

 FAIL  src/__tests__/utils/encryption.test.js > encryption utilities > decryptData > should decrypt data successfully
AssertionError: expected "spy" to be called with arguments: [ 'raw', Any<Uint8Array>, …(3) ][90m

Received: 

[1m  1st spy call:

[22m[33m@@ -1,8 +1,22 @@[90m
[2m  [[22m
[2m    "raw",[22m
[32m-   Any<Uint8Array>,[90m
[31m+   Uint8Array [[90m
[31m+     116,[90m
[31m+     101,[90m
[31m+     115,[90m
[31m+     116,[90m
[31m+     45,[90m
[31m+     112,[90m
[31m+     97,[90m
[31m+     115,[90m
[31m+     115,[90m
[31m+     119,[90m
[31m+     111,[90m
[31m+     114,[90m
[31m+     100,[90m
[31m+   ],[90m
[2m    {[22m
[2m      "name": "PBKDF2",[22m
[2m    },[22m
[2m    false,[22m
[2m    [[22m
[39m[90m

Number of calls: [1m1[22m
[39m
 ❯ src/__tests__/utils/encryption.test.js:142:49
    140| 
    141|             // Verify crypto calls
    142|             expect(mockCrypto.subtle.importKey).toHaveBeenCalledWith(
       |                                                 ^
    143|                 'raw',
    144|                 expect.any(Uint8Array),

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[13/13]⎯


 Test Files  4 failed | 8 passed (12)
      Tests  13 failed | 134 passed (147)
   Start at  17:30:54
   Duration  2.44s (transform 444ms, setup 1.07s, collect 1.17s, tests 1.21s, environment 6.24s, prepare 1.42s)

